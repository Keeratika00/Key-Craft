<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Key & Craft</title>

<style>
html,body{
  margin:0;
  height:100%;
  background:#111;
  color:#fff;
  font-family:sans-serif
}
canvas{
  display:block;
  background:linear-gradient(#0b2340,#041020)
}
#startScreen,#summary{
  position:fixed;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  background:#000c;
}
.button{
  background:#1e90ff;
  padding:12px 26px;
  border-radius:10px;
  font-weight:700;
  cursor:pointer;
  margin-top:16px;
}
#bottomBar{
  position:fixed;
  left:0; right:0; bottom:0;
  height:120px;
  display:flex;
  gap:12px;
  justify-content:center;
  align-items:center;
  pointer-events:none;
}
.itemCard{
  width:90px;
  height:90px;
  border-radius:16px;
  display:flex;
  align-items:center;
  justify-content:center;
  background:#222;
}
.itemCard img{
  width:70px;
  height:70px;
}
#topBar{
  position:fixed;
  top:12px;
  left:12px;
  font-size:22px;
}

/* ===== Mobile Input ===== */
#mobileUI{
  position:fixed;
  left:0; right:0; bottom:0;
  display:none;
  flex-direction:column;
  align-items:center;
  gap:10px;
  padding-bottom:12px;
}

/* ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏Å‡∏î‡πÅ‡∏•‡πâ‡∏ß */
#inputDisplay{
  font-size:28px;
  font-weight:700;
  min-height:34px;
  letter-spacing:4px;
}

/* ‡πÅ‡∏ú‡∏á‡∏õ‡∏∏‡πà‡∏° */
#numPad{
  display:grid;
  grid-template-columns:repeat(5,64px);
  gap:10px;
}

/* ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏Ç */
.numBtn{
  width:64px;
  height:64px;
  border-radius:16px;
  background:#333;
  color:#fff;
  font-size:22px;
  font-weight:700;
  display:flex;
  align-items:center;
  justify-content:center;
  user-select:none;
  transition:0.15s;
}
.numBtn.active{
  background:#1e90ff;
  transform:scale(0.9);
}
</style>
</head>

<body>

<canvas id="c"></canvas>
<div id="topBar"></div>

<div id="startScreen">
  <div style="text-align:center">
    <h1>Key & Craft</h1>
    <p>‡∏Å‡∏î‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</p>
    <div class="button" id="startBtn">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</div>
  </div>
</div>

<div id="bottomBar"></div>

<!-- ===== Mobile UI ===== -->
<div id="mobileUI">
  <div id="inputDisplay"></div>
  <div id="numPad"></div>
</div>

<div id="summary" style="display:none">
  <div style="text-align:center">
    <h2>‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
    <div id="summaryList"
      style="display:flex;gap:16px;flex-wrap:wrap;justify-content:center">
    </div>
    <div class="button" id="restartBtn">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</div>
  </div>
</div>

<script>
/* ================= SETUP ================= */
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');

function resize(){
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}
resize();
window.onresize = resize;

/* ================= DATA ================= */
const categories=[
 {key:'Mouse',imgs:['images/mouse/mouse1.png','images/mouse/mouse2.png','images/mouse/mouse3.png']},
 {key:'Keyboard',imgs:['images/keyboard/kb1.png','images/keyboard/kb2.png','images/keyboard/kb3.png']}
];
const junkImages=['images/junk/junk1.png','images/junk/junk2.png'];

const imageCache={};
[...categories.flatMap(c=>c.imgs),...junkImages].forEach(src=>{
 const i=new Image();i.src=src;imageCache[src]=i;
});

/* ================= STATE ================= */
const MAX_HEARTS=3;
let hearts=MAX_HEARTS;
let queue=[],current=null,items=[],collected={};
let state='start';
let inputBuffer='',inputTimer=null;
let spawnImagePool=[];

/* ================= SPAWN ================= */
function spawnScene(){
 items=[];
 spawnImagePool=[...current.imgs].sort(()=>Math.random()-0.5);
 let c=0;
 const iv=setInterval(()=>{
   spawnItem(Math.random()<0.4);
   if(++c>=5) clearInterval(iv);
 },280);
}
function spawnItem(isJunk){
 const img=isJunk?junkImages[Math.floor(Math.random()*junkImages.length)]:spawnImagePool.shift();
 items.push({
   number:Math.floor(Math.random()*90)+10,
   isJunk,
   img,
   x:Math.random()*(innerWidth-200)+100,
   y:-60,
   size:80,
   speed:300,
   turnY:innerHeight*0.55,
   phase:'down',
   alive:true
 });
}

/* ================= INPUT ================= */
function handleNumberInput(d){
 if(state!=='game')return;
 inputBuffer+=d;
 inputDisplay.textContent=inputBuffer;

 clearTimeout(inputTimer);
 inputTimer=setTimeout(()=>{
   const num=parseInt(inputBuffer);
   inputBuffer='';
   inputDisplay.textContent='';
   for(let it of items){
     if(it.alive&&it.number===num){
       it.phase='up';
       break;
     }
   }
 },350);
}

window.addEventListener('keydown',e=>{
 if(/^\d$/.test(e.key)) handleNumberInput(e.key);
});

/* mobile buttons */
const numPad=document.getElementById('numPad');
for(let i=0;i<=9;i++){
 const b=document.createElement('div');
 b.className='numBtn';
 b.textContent=i;
 b.onclick=()=>{
   b.classList.add('active');
   handleNumberInput(String(i));
   setTimeout(()=>b.classList.remove('active'),150);
 };
 numPad.appendChild(b);
}

/* ================= LOOP ================= */
function update(dt){
 if(state!=='game')return;
 items.forEach(it=>{
   if(!it.alive)return;
   it.y+= (it.phase==='down'?it.speed:-it.speed)*dt;
   if(it.phase==='down'&&it.y>it.turnY)it.phase='up';
   if(it.y<-120)it.alive=false;
 });
 if(items.length&&!items.some(i=>i.alive)) nextCategory();
}
function draw(){
 ctx.clearRect(0,0,innerWidth,innerHeight);
 if(state!=='game')return;
 items.forEach(it=>{
   if(!it.alive)return;
   const h=it.size/2;
   ctx.drawImage(imageCache[it.img],it.x-h,it.y-h,it.size,it.size);
   ctx.fillStyle='#fff';
   ctx.textAlign='center';
   ctx.font='20px sans-serif';
   ctx.fillText(it.number,it.x,it.y+h+28);
 });
}
let last=performance.now();
function loop(t){
 const dt=(t-last)/1000; last=t;
 update(dt); draw();
 requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

/* ================= FLOW ================= */
function nextCategory(){
 if(queue.length===0){state='summary';summary.style.display='flex';return;}
 current=queue.shift();
 spawnScene();
}
startBtn.onclick=()=>{
 state='game';
 startScreen.style.display='none';
 mobileUI.style.display='flex'; // üëà ‡πÇ‡∏ä‡∏ß‡πå‡∏õ‡∏∏‡πà‡∏°‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠
 queue=[...categories];
 nextCategory();
};
restartBtn.onclick=()=>location.reload();
</script>
</body>
</html>
