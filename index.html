<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Key & Craft - Hybrid Version</title>

<style>
  html, body {
    margin: 0;
    height: 100%;
    background: #111;
    color: #fff;
    font-family: sans-serif;
    overflow: hidden;
    touch-action: none;
  }
  canvas {
    display: block;
    background: linear-gradient(#0b2340, #041020);
  }

  /* ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏£‡∏∏‡∏õ */
  #startScreen, #summary {
    position: fixed;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #000c;
    z-index: 100;
  }

  .button {
    background: #1e90ff;
    padding: 12px 26px;
    border-radius: 10px;
    font-weight: 700;
    cursor: pointer;
    margin-top: 16px;
  }

  /* ‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á */
  #controls {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: #1a1a1a;
    padding: 15px 10px;
    display: flex;
    flex-direction: column;
    gap: 12px;
    border-top: 2px solid #333;
    z-index: 50;
  }

  /* --- ‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏´‡∏•‡∏±‡∏Å: ‡∏™‡∏•‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á PC ‡πÅ‡∏•‡∏∞ ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ --- */
  
  /* ‡∏Å‡∏£‡∏ì‡∏µ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÉ‡∏´‡∏ç‡πà (‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 768px ‡∏´‡∏£‡∏∑‡∏≠ PC) ‡πÉ‡∏´‡πâ‡∏ã‡πà‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç */
  @media (min-width: 769px) {
    #numpad {
      display: none !important;
    }
    #controls {
      background: transparent; /* ‡πÉ‡∏´‡πâ‡∏î‡∏π‡πÇ‡∏•‡πà‡∏á‡πÜ ‡∏ö‡∏ô PC */
      border: none;
      pointer-events: none; /* ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏õ‡πÇ‡∏î‡∏ô Canvas ‡πÑ‡∏î‡πâ */
    }
    #bottomBar {
      pointer-events: auto; /* ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏î‡∏π‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡πÑ‡∏î‡πâ */
    }
  }

  /* ‡πÅ‡∏ñ‡∏ö‡πÇ‡∏ä‡∏ß‡πå‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏î‡πâ */
  #bottomBar {
    height: 65px;
    display: flex;
    gap: 10px;
    justify-content: center;
    align-items: center;
    overflow-x: auto;
  }

  .itemCard {
    width: 50px;
    height: 50px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #333;
    flex-shrink: 0;
  }
  .itemCard img {
    width: 40px;
    height: 40px;
  }

  /* ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏î‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÅ‡∏ö‡∏ö‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö 3 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå */
  #numpad {
    display: grid;
    grid-template-columns: repeat(3, 1fr); /* ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö 3 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå */
    gap: 10px;
    max-width: 280px; 
    margin: 0 auto;
    width: 100%;
  }

  .numBtn {
    background: #444;
    color: white;
    border: none;
    height: 55px;
    font-size: 24px;
    font-weight: bold;
    border-radius: 12px;
    box-shadow: 0 4px 0 #222;
    cursor: pointer;
    transition: background 0.1s;
    user-select: none;
    -webkit-tap-highlight-color: transparent;
  }

  .numBtn.active {
    background: #ffcc00 !important;
    color: #000 !important;
    transform: translateY(3px);
    box-shadow: 0 1px 0 #222;
  }

  /* ‡∏ß‡∏≤‡∏á‡πÄ‡∏•‡∏Ç 0 ‡πÑ‡∏ß‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà 4 */
  .numBtn[data-val="0"] {
    grid-column: 2;
  }

  #topBar {
    position: fixed;
    top: 12px;
    left: 12px;
    font-size: 22px;
  }
</style>
</head>

<body>

<canvas id="c"></canvas>
<div id="topBar"></div>

<div id="startScreen">
  <div style="text-align:center">
    <h1>Key & Craft</h1>
    <p>‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÑ‡∏≠‡πÄ‡∏ó‡∏°</p>
    <div class="button" id="startBtn">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</div>
  </div>
</div>

<div id="controls">
  <div id="bottomBar"></div> 
  <div id="numpad"> 
    <button class="numBtn" data-val="1">1</button>
    <button class="numBtn" data-val="2">2</button>
    <button class="numBtn" data-val="3">3</button>
    <button class="numBtn" data-val="4">4</button>
    <button class="numBtn" data-val="5">5</button>
    <button class="numBtn" data-val="6">6</button>
    <button class="numBtn" data-val="7">7</button>
    <button class="numBtn" data-val="8">8</button>
    <button class="numBtn" data-val="9">9</button>
    <button class="numBtn" data-val="0">0</button>
  </div>
</div>

<div id="summary" style="display:none">
  <div style="text-align:center">
    <h2>‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
    <div id="summaryList" style="display:flex;gap:12px;flex-wrap:wrap;justify-content:center;margin-bottom:20px;"></div>
    <div class="button" id="restartBtn">‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</div>
  </div>
</div>

<script>
/* ================= SETUP & DATA ================= */
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
let dpr = window.devicePixelRatio || 1;

function resize(){
  canvas.width = innerWidth * dpr;
  canvas.height = innerHeight * dpr;
  canvas.style.width = innerWidth+'px';
  canvas.style.height = innerHeight+'px';
  ctx.setTransform(dpr,0,0,dpr,0,0);
}
resize();
window.onresize = resize;

const categories = [
 {key:'Mouse',label:'Mouse',imgs:['images/mouse/mouse1.png','images/mouse/mouse2.png','images/mouse/mouse3.png','images/mouse/mouse4.png','images/mouse/mouse5.png']},
 {key:'Keyboard',label:'Keyboard',imgs:['images/keyboard/kb1.png','images/keyboard/kb2.png','images/keyboard/kb3.png','images/keyboard/kb4.png','images/keyboard/kb5.png']},
 {key:'Mousepad',label:'Mousepad',imgs:['images/mousepad/mp1.png','images/mousepad/mp2.png','images/mousepad/mp3.png','images/mousepad/mp4.png','images/mousepad/mp5.png']},
 {key:'Headset',label:'Headset',imgs:['images/headset/hs1.png','images/headset/hs2.png','images/headset/hs3.png','images/headset/hs4.png','images/headset/hs5.png']},
 {key:'Controller',label:'Controller',imgs:['images/controller/ct1.png','images/controller/ct2.png','images/controller/ct3.png','images/controller/ct4.png','images/controller/ct5.png']},
 {key:'Chair',label:'Chair',imgs:['images/chair/ch1.png','images/chair/ch2.png','images/chair/ch3.png','images/chair/ch4.png','images/chair/ch5.png']}
];

const junkImages=['images/junk/junk1.png','images/junk/junk2.png'];
const imageCache={};
[...categories.flatMap(c=>c.imgs),...junkImages].forEach(src=>{
 const img=new Image(); img.src=src; imageCache[src]=img;
});

/* ================= STATE ================= */
const MAX_HEARTS=3;
let hearts=MAX_HEARTS, queue=[], current=null, items=[], collected={}, state='start';
let inputBuffer='', inputTimer=null, particles=[], shake=0, redFlash=0, spawnImagePool=[];

/* ================= LOGIC ================= */
function spawnScene(){
 items=[];
 spawnImagePool=[...current.imgs].sort(()=>Math.random()-0.5);
 let count=0;
 const iv=setInterval(()=>{
   spawnItem(Math.random()<0.4);
   count++;
   if(count>=5) clearInterval(iv);
 },280);
}

function spawnItem(isJunk){
 let imgSrc = isJunk ? junkImages[Math.floor(Math.random()*junkImages.length)] : (spawnImagePool.length ? spawnImagePool.shift() : current.imgs[0]);
 items.push({
   number:Math.floor(Math.random()*99)+1,
   isJunk, img:imgSrc, x:Math.random()*(innerWidth-100)+50, y:-60, size:70,
   speedDown: Math.random()*150 + 200,
   speedUp: -(Math.random()*200 + 250),
   turnY: innerHeight * 0.35, 
   phase:'down', alive:true
 });
}

function explode(x,y,color){
 for(let i=0;i<12;i++){
   particles.push({x,y,vx:(Math.random()-0.5)*300,vy:(Math.random()-0.5)*300,life:0.5,color});
 }
}

/* ================= INPUT HANDLER ================= */
function handleDigitInput(digit) {
  if(state !== 'game') return;

  const btn = document.querySelector(`.numBtn[data-val="${digit}"]`);
  if(btn) {
    btn.classList.add('active');
    setTimeout(() => btn.classList.remove('active'), 100);
  }

  inputBuffer += digit;
  clearTimeout(inputTimer);

  inputTimer = setTimeout(() => {
    const num = parseInt(inputBuffer);
    inputBuffer = '';
    for(let it of items){
      if(it.alive && it.number === num){
        explode(it.x, it.y, it.isJunk ? '#ff4444' : '#00ffcc');
        it.phase='up';
        if(it.isJunk){
          hearts--; updateHearts(); shake=15; redFlash=10;
          if(hearts<=0) showSummary();
        } else {
          collectCurrent(it.img);
          items.forEach(i => i.phase='up');
        }
        break;
      }
    }
  }, 350);
}

document.querySelectorAll('.numBtn').forEach(btn => {
  btn.addEventListener('pointerdown', (e) => {
    e.preventDefault();
    handleDigitInput(btn.getAttribute('data-val'));
  });
});

window.addEventListener('keydown', e => {
  if(/^\d$/.test(e.key)) handleDigitInput(e.key);
});

/* ================= UPDATE & DRAW ================= */
function update(dt){
 if(state!=='game')return;
 items.forEach(it=>{
   if(!it.alive)return;
   it.y += (it.phase==='down'?it.speedDown:it.speedUp)*dt;
   if(it.phase==='down'&&it.y>it.turnY)it.phase='up';
   if(it.y<-120)it.alive=false;
 });
 particles.forEach(p=>{ p.x+=p.vx*dt; p.y+=p.vy*dt; p.vy+=800*dt; p.life-=dt; });
 particles=particles.filter(p=>p.life>0);
 if(shake>0)shake-=dt*60;
 if(redFlash>0)redFlash-=dt*60;
 if(items.length&&!items.some(i=>i.alive)){
   if(!collected[current.key])queue.push(current);
   nextCategory();
 }
}

function draw(){
 ctx.clearRect(0,0,innerWidth,innerHeight);
 if(state!=='game')return;
 if(shake>0){ ctx.save(); ctx.translate(Math.random()*8-4,Math.random()*8-4); }
 items.forEach(it=>{
   if(!it.alive)return;
   const img=imageCache[it.img];
   if(img && img.complete){
     ctx.drawImage(img,it.x-it.size/2,it.y-it.size/2,it.size,it.size);
     if(it.isJunk){ ctx.strokeStyle='red'; ctx.lineWidth=3; ctx.strokeRect(it.x-it.size/2,it.y-it.size/2,it.size,it.size); }
   }
   ctx.fillStyle=it.isJunk?'#ff4444':'#fff';
   ctx.font='bold 22px sans-serif'; ctx.textAlign='center';
   ctx.fillText(it.number, it.x, it.y+it.size/2+25);
 });
 particles.forEach(p=>{ ctx.fillStyle=p.color; ctx.fillRect(p.x,p.y,4,4); });
 if(shake>0)ctx.restore();
 if(redFlash>0){ ctx.strokeStyle='rgba(255,0,0,0.5)'; ctx.lineWidth=10; ctx.strokeRect(0,0,innerWidth,innerHeight); }
}

/* ================= FLOW ================= */
function collectCurrent(imgSrc){
 if(collected[current.key])return;
 collected[current.key]={img:imgSrc};
 const card=document.createElement('div');
 card.className='itemCard';
 const im=document.createElement('img'); im.src=imgSrc;
 card.appendChild(im);
 document.getElementById('bottomBar').appendChild(card);
}

function nextCategory(){
 if(queue.length===0){ showSummary(); return; }
 current=queue.shift();
 spawnScene();
}

function updateHearts(){
 topBar.textContent='‚ù§Ô∏è'.repeat(hearts)+'ü§ç'.repeat(MAX_HEARTS-hearts);
}

function showSummary(){
 state='summary';
 summary.style.display='flex';
 summaryList.innerHTML='';
 Object.values(collected).forEach(c=>{
   const d=document.createElement('div'); d.className='itemCard';
   const im=document.createElement('img'); im.src=c.img;
   d.appendChild(im); summaryList.appendChild(d);
 });
}

startBtn.onclick=()=>{
 state='game'; startScreen.style.display='none';
 hearts=MAX_HEARTS; collected={}; document.getElementById('bottomBar').innerHTML='';
 queue=[...categories]; updateHearts(); nextCategory();
};
restartBtn.onclick=()=>location.reload();

function loop(t){
 update((t-(this.last||t))/1000); this.last=t;
 draw(); requestAnimationFrame(loop);
}
requestAnimationFrame(loop);
</script>
</body>
</html>
