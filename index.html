<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Key & Craft - Final Responsive</title>

<style>
  html, body {
    margin: 0;
    height: 100%;
    background: #111;
    color: #fff;
    font-family: sans-serif;
    overflow: hidden;
    touch-action: none;
  }
  canvas {
    display: block;
    background: linear-gradient(#0b2340, #041020);
  }

  #startScreen, #summary {
    position: fixed;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #000c;
    z-index: 100;
  }

  .button {
    background: #1e90ff;
    padding: 12px 26px;
    border-radius: 10px;
    font-weight: 700;
    cursor: pointer;
    margin-top: 16px;
  }

  /* --- ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÉ‡∏´‡πâ Compact ‡∏Ç‡∏∂‡πâ‡∏ô --- */
  #controls {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: #1a1a1a;
    padding: 6px 5px; /* ‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ç‡∏≠‡∏ö‡πÅ‡∏ú‡∏á */
    display: flex;
    flex-direction: column;
    gap: 4px; /* ‡∏•‡∏î‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á Inventory ‡∏Å‡∏±‡∏ö Numpad */
    border-top: 1px solid #333;
    z-index: 50;
    align-items: center;
  }

  #topBar {
    position: fixed;
    top: 10px;
    left: 12px;
    font-size: 20px;
    text-shadow: 1px 1px 2px #000;
    z-index: 10;
  }

  #bottomBar {
    height: 50px; /* ‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÅ‡∏ñ‡∏ö‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏•‡∏á */
    display: flex;
    gap: 6px;
    justify-content: center;
    align-items: center;
    overflow-x: auto;
    width: 100%;
  }

  .itemCard {
    width: 40px; /* ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏Å‡∏£‡∏≠‡∏ö‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏•‡∏á‡∏ô‡∏¥‡∏î‡∏ô‡∏∂‡∏á */
    height: 40px;
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #333;
    flex-shrink: 0;
  }
  .itemCard img {
    width: 32px;
    height: 32px;
    object-fit: contain;
  }

  #numpad {
    display: grid !important;
    grid-template-columns: repeat(3, 1fr) !important;
    gap: 6px !important; /* ‡∏õ‡∏∏‡πà‡∏°‡∏ä‡∏¥‡∏î‡∏Å‡∏±‡∏ô‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô */
    width: 100% !important;
    max-width: 250px !important; /* ‡∏ö‡∏µ‡∏ö‡πÉ‡∏´‡πâ‡πÅ‡∏Ñ‡∏ö‡∏•‡∏á‡∏≠‡∏µ‡∏Å‡∏ô‡∏¥‡∏î */
    margin: 0 auto !important;
  }

  .numBtn {
    background: #444;
    color: white;
    border: none;
    height: 42px; /* ‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏á‡∏û‡∏≠‡∏™‡∏°‡∏Ñ‡∏ß‡∏£ */
    font-size: 20px; /* ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ö‡∏ô‡∏õ‡∏∏‡πà‡∏° */
    font-weight: bold;
    border-radius: 8px;
    box-shadow: 0 3px 0 #222; /* ‡∏•‡∏î‡πÄ‡∏á‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î */
    cursor: pointer;
    transition: background 0.1s;
    user-select: none;
    -webkit-tap-highlight-color: transparent;
  }

  .numBtn.active {
    background: #ffcc00 !important;
    color: #000 !important;
    transform: translateY(2px);
    box-shadow: 0 1px 0 #222;
  }

  .numBtn[data-val="0"] {
    grid-column: 2;
  }

  /* --- PC Sizing (‡πÉ‡∏´‡πâ‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°) --- */
  @media (min-width: 769px) {
    #numpad { display: none !important; }
    #controls { background: transparent; border: none; pointer-events: none; padding: 0; }
    #topBar { top: 20px; left: 20px; font-size: 45px; }
    #bottomBar { height: 140px; pointer-events: auto; }
    .itemCard { width: 110px; height: 110px; }
    .itemCard img { width: 90px; height: 90px; }
    h1 { font-size: 3.5rem; }
    p { font-size: 1.5rem; }
  }
</style>
</head>

<body>

<canvas id="c"></canvas>
<div id="topBar"></div>

<div id="startScreen">
  <div style="text-align:center">
    <h1>Key & Craft</h1>
    <p>‡∏Å‡∏î‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πá‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</p>
    <div class="button" id="startBtn">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</div>
  </div>
</div>

<div id="controls">
  <div id="bottomBar"></div> 
  <div id="numpad"> 
    <button class="numBtn" data-val="1">1</button>
    <button class="numBtn" data-val="2">2</button>
    <button class="numBtn" data-val="3">3</button>
    <button class="numBtn" data-val="4">4</button>
    <button class="numBtn" data-val="5">5</button>
    <button class="numBtn" data-val="6">6</button>
    <button class="numBtn" data-val="7">7</button>
    <button class="numBtn" data-val="8">8</button>
    <button class="numBtn" data-val="9">9</button>
    <button class="numBtn" data-val="0">0</button>
  </div>
</div>

<div id="summary" style="display:none">
  <div style="text-align:center">
    <h2>‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</h2>
    <div id="summaryList" style="display:flex;gap:12px;flex-wrap:wrap;justify-content:center;margin-bottom:20px;"></div>
    <div class="button" id="restartBtn">‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</div>
  </div>
</div>

<script>
/* ================= SETUP ================= */
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
let dpr = window.devicePixelRatio || 1;

function resize(){
  canvas.width = innerWidth * dpr;
  canvas.height = innerHeight * dpr;
  canvas.style.width = innerWidth+'px';
  canvas.style.height = innerHeight+'px';
  ctx.setTransform(dpr,0,0,dpr,0,0);
}
resize();
window.onresize = resize;

/* ================= DATA ================= */
const categories = [
 {key:'Mouse',label:'Mouse',imgs:['images/mouse/mouse1.png','images/mouse/mouse2.png','images/mouse/mouse3.png','images/mouse/mouse4.png','images/mouse/mouse5.png']},
 {key:'Keyboard',label:'Keyboard',imgs:['images/keyboard/kb1.png','images/keyboard/kb2.png','images/keyboard/kb3.png','images/keyboard/kb4.png','images/keyboard/kb5.png']},
 {key:'Mousepad',label:'Mousepad',imgs:['images/mousepad/mp1.png','images/mousepad/mp2.png','images/mousepad/mp3.png','images/mousepad/mp4.png','images/mousepad/mp5.png']},
 {key:'Headset',label:'Headset',imgs:['images/headset/hs1.png','images/headset/hs2.png','images/headset/hs3.png','images/headset/hs4.png','images/headset/hs5.png']},
 {key:'Controller',label:'Controller',imgs:['images/controller/ct1.png','images/controller/ct2.png','images/controller/ct3.png','images/controller/ct4.png','images/controller/ct5.png']},
 {key:'Chair',label:'Chair',imgs:['images/chair/ch1.png','images/chair/ch2.png','images/chair/ch3.png','images/chair/ch4.png','images/chair/ch5.png']}
];

const junkImages=['images/junk/junk1.png','images/junk/junk2.png'];
const imageCache={};
[...categories.flatMap(c=>c.imgs),...junkImages].forEach(src=>{
 const img=new Image(); img.src=src; imageCache[src]=img;
});

/* ================= STATE ================= */
const MAX_HEARTS=3;
let hearts=MAX_HEARTS, queue=[], current=null, items=[], collected={}, state='start';
let inputBuffer='', inputTimer=null, particles=[], shake=0, redFlash=0, spawnImagePool=[];

/* ================= LOGIC (‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏Å‡∏±‡∏ö‡∏à‡∏≠) ================= */
function spawnScene(){
 items=[];
 spawnImagePool=[...current.imgs].sort(()=>Math.random()-0.5);
 let count=0;
 const iv=setInterval(()=>{
   spawnItem(Math.random()<0.4);
   count++;
   if(count>=5) clearInterval(iv);
 },280);
}

function spawnItem(isJunk){
  let imgSrc = isJunk ? junkImages[Math.floor(Math.random()*junkImages.length)] : (spawnImagePool.length ? spawnImagePool.shift() : current.imgs[0]);
  
  // ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏ï‡∏≤‡∏°‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏à‡∏≠
  let baseSpeedDown = innerHeight * (Math.random() * 0.15 + 0.20); 
  let baseSpeedUp = -(innerHeight * (Math.random() * 0.2 + 0.35));

  items.push({
    number: Math.floor(Math.random()*99)+1,
    isJunk, img:imgSrc, x:Math.random()*(innerWidth-100)+50, y:-80, size:70,
    speedDown: baseSpeedDown,
    speedUp: baseSpeedUp,
    turnY: innerHeight * 0.35, 
    phase:'down', alive:true
  });
}

function explode(x,y,color){
 for(let i=0;i<12;i++){
   particles.push({x,y,vx:(Math.random()-0.5)*300,vy:(Math.random()-0.5)*300,life:0.5,color});
 }
}

function handleDigitInput(digit) {
  if(state !== 'game') return;
  const btn = document.querySelector(`.numBtn[data-val="${digit}"]`);
  if(btn) {
    btn.classList.add('active');
    setTimeout(() => btn.classList.remove('active'), 100);
  }
  inputBuffer += digit;
  clearTimeout(inputTimer);
  inputTimer = setTimeout(() => {
    const num = parseInt(inputBuffer);
    inputBuffer = '';
    for(let it of items){
      if(it.alive && it.number === num){
        explode(it.x, it.y, it.isJunk ? '#ff4444' : '#00ffcc');
        it.phase='up';
        if(it.isJunk){
          hearts--; updateHearts(); shake=15; redFlash=10;
          if(hearts<=0) showSummary();
        } else {
          collectCurrent(it.img);
          items.forEach(i => i.phase='up');
        }
        break;
      }
    }
  }, 350);
}

document.querySelectorAll('.numBtn').forEach(btn => {
  btn.addEventListener('pointerdown', (e) => {
    e.preventDefault(); handleDigitInput(btn.getAttribute('data-val'));
  });
});

window.addEventListener('keydown', e => {
  if(/^\d$/.test(e.key)) handleDigitInput(e.key);
});

/* ================= UPDATE & DRAW ================= */
function update(dt){
 if(state!=='game')return;
 items.forEach(it=>{
   if(!it.alive)return;
   it.y += (it.phase==='down'?it.speedDown:it.speedUp)*dt;
   if(it.phase==='down'&&it.y>it.turnY)it.phase='up';
   if(it.y<-150)it.alive=false;
 });
 particles.forEach(p=>{ p.x+=p.vx*dt; p.y+=p.vy*dt; p.vy+=800*dt; p.life-=dt; });
 particles=particles.filter(p=>p.life>0);
 if(shake>0)shake-=dt*60;
 if(redFlash>0)redFlash-=dt*60;
 if(items.length&&!items.some(i=>i.alive)){
   if(!collected[current.key])queue.push(current);
   nextCategory();
 }
}

function draw(){
 ctx.clearRect(0,0,innerWidth,innerHeight);
 if(state!=='game')return;
 if(shake>0){ ctx.save(); ctx.translate(Math.random()*8-4,Math.random()*8-4); }
 
 items.forEach(it=>{
   if(!it.alive)return;
   const img=imageCache[it.img];
   let displaySize = innerWidth > 768 ? it.size * 1.5 : it.size;

   if(img && img.complete){
     ctx.drawImage(img,it.x-displaySize/2,it.y-displaySize/2,displaySize,displaySize);
     if(it.isJunk){ ctx.strokeStyle='red'; ctx.lineWidth=3; ctx.strokeRect(it.x-displaySize/2,it.y-displaySize/2,displaySize,displaySize); }
   }
   
   ctx.fillStyle=it.isJunk?'#ff4444':'#fff';
   let fontSize = innerWidth > 768 ? '40px' : '22px'; 
   ctx.font = `bold ${fontSize} sans-serif`;
   ctx.textAlign='center';
   ctx.fillText(it.number, it.x, it.y+displaySize/2+(innerWidth > 768 ? 45 : 25));
 });
 
 particles.forEach(p=>{ ctx.fillStyle=p.color; ctx.fillRect(p.x,p.y,4,4); });
 if(shake>0)ctx.restore();
 if(redFlash>0){ ctx.strokeStyle='rgba(255,0,0,0.5)'; ctx.lineWidth=10; ctx.strokeRect(0,0,innerWidth,innerHeight); }
}

/* ================= FLOW ================= */
function collectCurrent(imgSrc){
 if(collected[current.key])return;
 collected[current.key]={img:imgSrc};
 const card=document.createElement('div');
 card.className='itemCard';
 const im=document.createElement('img'); im.src=imgSrc;
 card.appendChild(im);
 document.getElementById('bottomBar').appendChild(card);
}

function nextCategory(){
 if(queue.length===0){ showSummary(); return; }
 current=queue.shift();
 spawnScene();
}

function updateHearts(){
 topBar.textContent='‚ù§Ô∏è'.repeat(hearts)+'ü§ç'.repeat(MAX_HEARTS-hearts);
}

function showSummary(){
 state='summary';
 summary.style.display='flex';
 summaryList.innerHTML='';
 Object.values(collected).forEach(c=>{
   const d=document.createElement('div'); d.className='itemCard';
   const im=document.createElement('img'); im.src=c.img;
   d.appendChild(im); summaryList.appendChild(d);
 });
}

startBtn.onclick=()=>{
 state='game'; startScreen.style.display='none';
 hearts=MAX_HEARTS; collected={}; document.getElementById('bottomBar').innerHTML='';
 queue=[...categories]; updateHearts(); nextCategory();
};
restartBtn.onclick=()=>location.reload();

function loop(t){
 update((t-(this.last||t))/1000); this.last=t;
 draw(); requestAnimationFrame(loop);
}
requestAnimationFrame(loop);
</script>
</body>
</html>




